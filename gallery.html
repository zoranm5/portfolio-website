<!DOCTYPE html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/styles.css" />
    <title>Galerija</title>
  </head>
  <body>
    <h1>Moja Galerija</h1>
    <button id="fb-login-btn">Prijavi se putem Facebooka</button>

    <div class="gallery">
      <img
        src="images/oslo1.jpg"
        class="gallery-image"
        data-title="Slika 1"
        alt="Slika 1"
      />
      <img
        src="images/oslo2.png"
        class="gallery-image"
        data-title="Slika 2"
        alt="Slika 2"
      />
      <img
        src="images/oslo3.jpg"
        class="gallery-image"
        data-title="Slika 3"
        alt="Slika 3"
      />
    </div>

    <!-- Modal for displaying image and comments -->
    <div id="commentModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-image-title">Komentiraj ovu sliku</h2>
        <img
          id="modal-image"
          src=""
          alt="Slika"
          style="width: 100%; border-radius: 5px; margin-bottom: 10px"
        />
        <textarea
          id="comment"
          placeholder="Ostavite komentar ovdje..."
        ></textarea>
        <button id="submit-comment">Pošalji</button>
        <div id="comment-section"></div>
      </div>
    </div>

    <script>
      // Facebook SDK
      window.fbAsyncInit = function () {
        FB.init({
          appId: '1029888568878799', // Zamijeni s pravim ID-om
          cookie: true,
          xfbml: true,
          version: 'v12.0',
        });

        FB.AppEvents.logPageView();

        // Provjeri da li je korisnik već prijavljen
        FB.getLoginStatus(function (response) {
          statusChangeCallback(response);
        });
      };

      // Dodaj ovu funkciju
      function statusChangeCallback(response) {
        if (response.status === 'connected') {
          document.getElementById('fb-login-btn').style.display = 'none'; // Sakrij dugme za prijavu
          document.getElementById('fb-logout-btn').style.display = 'block'; // Prikaži dugme za odjavu
        } else {
          document.getElementById('fb-login-btn').style.display = 'block'; // Prikaži dugme za prijavu
          document.getElementById('fb-logout-btn').style.display = 'none'; // Sakrij dugme za odjavu
        }
      }

      // Prijava
      document
        .getElementById('fb-login-btn')
        .addEventListener('click', function () {
          FB.login(
            function (response) {
              if (response.authResponse) {
                console.log('Uspješno prijavljen', response);
                statusChangeCallback(response); // Ažuriraj stanje
              } else {
                console.log('Korisnik je otkazao prijavu');
              }
            },
            { scope: 'public_profile,email' }
          );
        });

      // Odjava
      document.addEventListener('DOMContentLoaded', function () {
        // Kreiraj dugme za odjavu
        const logoutBtn = document.createElement('button');
        logoutBtn.id = 'fb-logout-btn';
        logoutBtn.textContent = 'Odjavi se';
        logoutBtn.style.display = 'none'; // Sakrij dugme za odjavu
        document.body.appendChild(logoutBtn);

        // Dodaj listener za odjavu
        logoutBtn.addEventListener('click', function () {
          FB.logout(function (response) {
            console.log('Odjavili ste se', response);
            statusChangeCallback(response); // Ažuriraj stanje
          });
        });
      });

      // Modal functionality
      var modal = document.getElementById('commentModal');
      var modalImage = document.getElementById('modal-image');
      var modalImageTitle = document.getElementById('modal-image-title');
      var images = document.querySelectorAll('.gallery-image');
      var span = document.getElementsByClassName('close')[0];

      images.forEach(function (image) {
        image.addEventListener('click', function () {
          modal.style.display = 'block';
          modalImageTitle.textContent = this.getAttribute('data-title');
          modalImage.src = this.src;
          loadComments(); // Load comments when opening the modal
        });
      });

      span.onclick = function () {
        modal.style.display = 'none';
        clearComment(); // Clear the comment textarea
      };

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = 'none';
          clearComment(); // Clear the comment textarea
        }
      };

      document
        .getElementById('submit-comment')
        .addEventListener('click', function () {
          var comment = document.getElementById('comment').value;
          if (comment) {
            var commentSection = document.getElementById('comment-section');
            var commentDiv = document.createElement('div');
            commentDiv.textContent = comment;

            // Create edit and delete buttons
            var editButton = document.createElement('button');
            editButton.textContent = 'Uredi';
            editButton.onclick = function () {
              document.getElementById('comment').value = comment;
              commentDiv.remove();
            };

            var deleteButton = document.createElement('button');
            deleteButton.textContent = 'Izbriši';
            deleteButton.onclick = function () {
              if (confirm('Da li ste sigurni da želite obrisati komentar?')) {
                commentDiv.remove();
              }
            };

            commentDiv.appendChild(editButton);
            commentDiv.appendChild(deleteButton);
            commentSection.appendChild(commentDiv);
            clearComment(); // Clear the comment textarea
          }
        });

      function clearComment() {
        document.getElementById('comment').value = '';
      }

      function loadComments() {
        // Load comments from storage or server
      }
    </script>

    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"
    ></script>
  </body>
</html>
